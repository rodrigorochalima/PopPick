<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>POPPIC</title>
  <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">
  <meta name="theme-color" content="#d4af37">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
  <script defer src="{{ url_for('static', filename='js/app.js') }}"></script>
</head>
<body class="app-body">
  <header class="app-header">
    <div class="brand">
      <span class="logo">üçøüé¨ <strong>POPPIC</strong></span>
      <span class="version">{{ version }}</span>
    </div>
    <nav class="top-actions">
      <img class="avatar" id="topAvatar" src="{{ user.avatar or '' }}" alt="avatar" onerror="this.style.display='none'"/>
      <span class="user" title="Usu√°rio logado">{{ user.name }}</span>
      <button id="accountBtn" class="ghost">Conta</button>
      <button id="backupBtn" class="ghost">Backup</button>
      <button id="restoreBtn" class="ghost">Restore</button>
      <button id="logoutBtn" class="danger">Sair</button>
    </nav>
  </header>

  <section class="toolbar">
    <input id="search" placeholder="Buscar filme..." />
    <select id="filter">
      <option value="todos">Todos</option>
      <option value="disney">Disney</option>
      <option value="universal">Universal</option>
      <option value="nasa">NASA</option>
    </select>

    <!-- Autocomplete TMDB -->
    <div class="add-box">
      <input id="tmdbQuery" placeholder="Adicionar filme (TMDB)..." autocomplete="off">
      <ul id="tmdbResults" class="results"></ul>
      <select id="tmdbStudio">
        <option value="">Est√∫dio‚Ä¶</option>
        <option value="disney">Disney</option>
        <option value="universal">Universal</option>
        <option value="nasa">NASA</option>
      </select>
    </div>
  </section>

  <main class="grid3" id="grid" aria-live="polite"></main>

  <template id="cardTpl">
    <article class="card">
      <div class="poster-wrap">
        <img class="poster" alt="Poster">
        <span class="tmdb"></span>
      </div>
      <h4 class="title"></h4>
      <p class="meta"></p>
      <div class="rating-line">
        <span class="mine"></span><span class="slash"> / </span><span class="site"></span>
      </div>
      <div class="actions">
        <button class="watchBtn">Assistido</button>
        <div class="stars" aria-label="Avaliar de 0 a 10">
          <!-- 10 estrelas -->
          <button class="star" data-score="1">‚òÖ</button>
          <button class="star" data-score="2">‚òÖ</button>
          <button class="star" data-score="3">‚òÖ</button>
          <button class="star" data-score="4">‚òÖ</button>
          <button class="star" data-score="5">‚òÖ</button>
          <button class="star" data-score="6">‚òÖ</button>
          <button class="star" data-score="7">‚òÖ</button>
          <button class="star" data-score="8">‚òÖ</button>
          <button class="star" data-score="9">‚òÖ</button>
          <button class="star" data-score="10">‚òÖ</button>
        </div>
      </div>
    </article>
  </template>

  <!-- Modal conta -->
  <dialog id="accountModal" class="modal light">
    <form method="dialog" class="modal-inner" id="accountForm">
      <h3>Minha conta</h3>

      <div class="avatar-row">
        <img id="accAvatarPreview" class="avatar big" alt="avatar" onerror="this.style.display='none'"/>
        <input type="file" id="avatarFile" accept="image/*">
        <button id="cropOpen" class="ghost" type="button">Ajustar recorte</button>
      </div>

      <label>Nome <input name="name" id="accName" required /></label>
      <label>Usu√°rio <input name="username" id="accUser" required /></label>

      <label>Pergunta secreta
        <select id="accQ">
          <option value="">Selecione‚Ä¶</option>
          <option>Nome do seu primeiro animal de estima√ß√£o?</option>
          <option>Nome da sua escola prim√°ria?</option>
          <option>Em que cidade voc√™ nasceu?</option>
          <option>Qual √© o time do cora√ß√£o?</option>
          <option>Nome do seu her√≥i de inf√¢ncia?</option>
          <option>Profiss√£o dos seus pais?</option>
          <option>Primeiro carro?</option>
          <option>Livro favorito?</option>
          <option>Filme favorito?</option>
          <option>Comida favorita?</option>
        </select>
      </label>
      <label>Resposta secreta <input name="a" id="accA" /></label>

      <fieldset class="pw-box">
        <legend>Trocar senha (opcional)</legend>
        <label>Senha atual <input type="password" id="oldPass" /></label>
        <label>Nova senha <input type="password" id="newPass" /></label>
      </fieldset>

      <menu class="modal-actions">
        <button value="cancel" class="ghost">Fechar</button>
        <button id="saveAccount" class="primary" value="default">Salvar</button>
      </menu>
    </form>
  </dialog>

  <!-- Modal de recorte simples -->
  <dialog id="cropModal" class="modal light">
    <div class="modal-inner">
      <h3>Ajustar avatar</h3>
      <canvas id="cropCanvas" width="300" height="300"></canvas>
      <input type="range" id="cropZoom" min="1" max="3" step="0.01" value="1">
      <menu class="modal-actions">
        <button class="ghost" id="cropCancel">Cancelar</button>
        <button class="primary" id="cropSave">Salvar</button>
      </menu>
    </div>
  </dialog>

  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('{{ url_for('static', filename='sw.js') }}').catch(()=>{});
    }
  </script>
</body>
</html>
