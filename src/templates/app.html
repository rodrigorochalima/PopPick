<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>POPPIC • App</title>
  <link rel="stylesheet" href="/static/css/styles.css">
</head>
<body class="app-body">

  <!-- Cabeçalho retrô -->
  <header class="app-header">
    <div class="brand"><span class="logo">🍿🎬</span><strong>POPPIC</strong><span class="version">v21.3</span></div>
    <div class="top-actions">
      <img id="topAvatar" class="avatar" alt="avatar" style="display:none">
      <span class="user">{{ user.name }}</span>
      <button id="accountBtn" class="ghost">Conta</button>
      <button id="backupBtn" class="ghost">Backup</button>
      <button id="restoreBtn" class="ghost">Restore</button>
      <button id="logoutBtn" class="danger">Sair</button>
    </div>
  </header>

  <!-- Painel TMDB + filtros -->
  <section class="toolbar">
    <div class="add-box">
      <label class="toolbar-title">🔎 Buscar filme no TMDB:</label>
      <input id="tmdbQuery" type="text" placeholder="Digite o título…">
      <ul id="tmdbResults" class="results"></ul>
    </div>

    <div>
      <label class="toolbar-title">🌍 Universo:</label>
      <select id="tmdbStudio">
        <option value="">Todos</option><option>universal</option><option>disney</option>
        <option>pixar</option><option>marvel</option><option>warner</option>
      </select>
    </div>

    <div style="flex:1 1 160px">
      <label class="toolbar-title">Buscar filme…</label>
      <input id="search" type="text" placeholder="Pesquisar na sua lista">
    </div>

    <div>
      <label class="toolbar-title">Filtro:</label>
      <select id="filter">
        <option value="todos">Todos</option><option value="universal">Universal</option>
        <option value="disney">Disney</option><option value="pixar">Pixar</option>
        <option value="marvel">Marvel</option><option value="warner">Warner</option>
      </select>
    </div>
  </section>

  <!-- Grade 3 colunas -->
  <section id="grid" class="grid3" aria-live="polite"></section>

  <!-- Template do card -->
  <template id="cardTpl">
    <article class="card">
      <div class="poster-wrap">
        <img class="poster" alt="poster">
        <button class="editTmdb" title="Corrigir ligação TMDB">🛠</button>
        <span class="tmdb"></span>
      </div>
      <h3 class="title"></h3>
      <div class="meta"></div>

      <div class="rating-line">
        <strong class="mine">x</strong> <span>/</span> <span class="site">x</span>
        <small class="watched-mini"></small>
      </div>

      <div class="actions">
        <button class="watchBtn">Marcar assistido</button>
        <div class="stars" aria-label="Avaliar">
          <button class="star" data-score="1">★</button><button class="star" data-score="2">★</button>
          <button class="star" data-score="3">★</button><button class="star" data-score="4">★</button>
          <button class="star" data-score="5">★</button><button class="star" data-score="6">★</button>
          <button class="star" data-score="7">★</button><button class="star" data-score="8">★</button>
          <button class="star" data-score="9">★</button><button class="star" data-score="10">★</button>
        </div>
      </div>
    </article>
  </template>

  <!-- Minha conta -->
  <dialog class="modal light" id="accountModal">
    <div class="modal-inner">
      <h3 class="modal-title">👤 Minha conta</h3>
      <div style="display:flex;gap:12px;align-items:center">
        <img id="accAvatarPreview" class="avatar big" style="display:none" alt="avatar">
        <div>
          <input id="avatarFile" type="file" accept="image/*">
          <div style="margin-top:6px"><button id="cropOpen" class="ghost">Ajustar avatar</button></div>
        </div>
      </div>
      <label>Nome <input id="accName" type="text"></label>
      <label>Usuário <input id="accUser" type="text" autocapitalize="none"></label>
      <label>Pergunta secreta
        <select id="accQ">
          <option value="">— selecionar —</option>
          <option>Nome do seu primeiro animal de estimação?</option>
          <option>Cidade onde nasceu sua mãe?</option>
          <option>Seu herói favorito do cinema?</option>
          <option>Primeiro professor que marcou sua vida?</option>
          <option>Seu filme preferido na infância?</option>
          <option>Nome do seu melhor amigo de infância?</option>
          <option>Marca do seu primeiro carro?</option>
          <option>Time do coração?</option>
          <option>Comida favorita?</option>
          <option>Primeiro show que você foi?</option>
        </select>
      </label>
      <label>Resposta secreta <input id="accA" type="text"></label>
      <div class="pw-box">
        <strong>Trocar senha (opcional)</strong>
        <label>Senha atual <input id="oldPass" type="password"></label>
        <label>Nova senha  <input id="newPass" type="password"></label>
      </div>
      <div class="modal-actions"><button class="ghost" id="accClose">Fechar</button><button id="saveAccount">Salvar</button></div>
    </div>
  </dialog>

  <!-- Cropper -->
  <dialog class="modal" id="cropModal">
    <div class="modal-inner">
      <h3 class="modal-title">🖼️ Ajustar avatar</h3>
      <canvas id="cropCanvas" width="300" height="300"></canvas>
      <input id="cropZoom" type="range" min="0.5" max="2" step="0.01" value="1">
      <div class="modal-actions"><button class="ghost" id="cropCancel">Cancelar</button><button id="cropSave">Salvar</button></div>
    </div>
  </dialog>

  <!-- Marcar assistido (com data) -->
  <dialog class="modal light" id="watchModal">
    <div class="modal-inner">
      <h3 class="modal-title">📅 Registrar visualização</h3>
      <input id="watchWhen" type="datetime-local">
      <div class="modal-actions"><button class="ghost" id="watchCancel">Cancelar</button><button id="watchSave">Salvar</button></div>
    </div>
  </dialog>

  <!-- Corrigir ligação TMDB -->
  <dialog class="modal light" id="relinkModal">
    <div class="modal-inner">
      <h3 class="modal-title">🛠 Corrigir ligação TMDB</h3>
      <input id="relinkQuery" type="text" placeholder="Buscar no TMDB…">
      <ul id="relinkResults" class="results" style="position:static;max-height:320px"></ul>
      <div class="modal-actions"><button class="ghost" id="relinkCancel">Fechar</button></div>
    </div>
  </dialog>

  <!-- Detalhes do filme -->
  <dialog class="modal light" id="detailsModal">
    <div class="modal-inner">
      <h3 class="modal-title" id="dTitle">Detalhes</h3>
      <img id="dPoster" alt="poster" style="width:120px;border-radius:12px">
      <p id="dInfo" class="hint"></p>
      <p id="dOverview"></p>
      <div class="modal-actions"><button class="ghost" id="dClose">Fechar</button></div>
    </div>
  </dialog>

  <script>window.APP_VERSION="{{ version|default('v21.3') }}";</script>
  <script src="/static/js/app.js" defer></script>
</body>
</html>
